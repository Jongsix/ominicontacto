; OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML
; OML OML OML OML OML OML OML OML OML     WARNING WARNING WARNING     OML OML OML OML OML OML OML OML OML OML OML OML
; OML OML OML OML OML OML OML OML OML     WARNING WARNING WARNING     OML OML OML OML OML OML OML OML OML OML OML OML
; OML OML OML OML OML OML OML OML OML     WARNING WARNING WARNING     OML OML OML OML OML OML OML OML OML OML OML OML
; OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML

;-----------------------------------------------------------------------------------------------------------;
; Do NOT edit this file as it is auto-generated by OMniLeads. All modifications to this file must be done 	;
; via the web gui. There are alternative files to make custom modifications, details at: 					;
; http://omnileads.net/configuration_files       															;
;-----------------------------------------------------------------------------------------------------------;

; Variables OML:
; OMLCAMPID = id de la campaña
; OMLCAMPQNAME = queue name de la cola de la campaña
; OMLCALLTYPE = phoneJS | dialerCall | preview | c2c-agendas | c2c-calificafiones | c2c-click2call
; OMLCALLTYPEID = 1 MANUALCALL | 2 DIALER | 3 INBOUND | 4 PREV | 5 ICS | 7 INTERNAL | 8 BLIND TRANSFER | 9 CONSULT TRANSFER
; OMLAGENTSIP = numero SIP del agente
; OMLAGENTID = OML-Ap ID-pk agente
; OMLAGENTNAME = callerid name del agente
; OMLCODCLI = id del contacto asociado a la llamada
; OMLMANUALCALLTYPEID = 1 | 2 | 3 | 4 (es el tipo de c2c, agendas, contactos, )
; OMLOUTNUM = el numero EXTERNO (que debe ser enrutado) discado
; BLACKLIST creada por sub-oml-blacklist. 1 true, 0 false.
; OMLRECFILENAME = nombre del archivo que contiene la grabacion de la llamada

; OMLRECTHISCALL = 1 yes | 0 no

; GM global variable to store the answer results
; ST timestamp que indica los ENTERQUEUE

; OMLCALLTYPE = phoneJS | dialerCall | c2c-preview | c2c-agendas | c2c-calificafiones | c2c-click2call
; OMLCALLTYPEID = 1 MANUALCALL | 2 DIALER | 3 IN | 4 PREV

; GLOBAL(${OMLAGENTSIP}result)} mantiene el resultado de cada alteración que sufre una llamada Manual y Preview
; GLOBAL(${OMLOUTNUM}result)} mantiene el resultado de cada alteración que sufre una llamada Dialer
; GLOBAL(${OMLOUTNUM}result)} mantiene el resultado de cada alteración que sufre una llamada Inbound


; OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML
; OML OML OML OML OML OML OML OML OML OML         LLAMADAS INTERNAS           OML OML OML OML OML OML OML OML OML
; OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML

[oml-dial-internal]
; llamadas hacia un agente, phoneJS disca AGENT o CAMP pero añade como HEADER el id de agente o campaña que hay que llamar

include => oml-dial-internal-custom

exten => AGENT,1,Verbose(2, call to agent ${SIP_HEADER(agentCall)})
same => n,Gosub(sub-oml-dial-internal,s,1(1,agentCall))

exten => CAMP,1,Verbose(2, call to campaign ${SIP_HEADER(campCall)})
same => n,Gosub(sub-oml-dial-internal,s,1(22,campCall))

; Blind Transfer Ag2Ag
exten => _0000X,1,Verbose(2, ag2agBlindTransfer ${EXTEN:4})
same => n,Gosub(sub-oml-ag2ag-blind-transfer,s,1(${EXTEN:4}))
exten => _0000XX,1,Verbose(2, ag2agBlindTransfer ${EXTEN:4})
same => n,Gosub(sub-oml-ag2ag-blind-transfer,s,1(${EXTEN:4}))
exten => _0000XXX,1,Verbose(2, agBlindTransfer ${EXTEN:4})
same => n,Gosub(sub-oml-ag2ag-blind-transfer,s,1(${EXTEN:4}))
exten => _0000XXXX,1,Verbose(2, agBlindTransfer ${EXTEN:4})
same => n,Gosub(sub-oml-ag2ag-blind-transfer,s,1(${EXTEN:4}))

; Consult Transfer Ag2Ag
exten => _1111X,1,Verbose(2, ag2agConsultTransfer ${EXTEN:4})
same => n,Gosub(sub-oml-ag2ag-consult-transfer,s,1(${EXTEN:4}))
exten => _1111XX,1,Verbose(2, ag2agConsultTransfer ${EXTEN:4})
same => n,Gosub(sub-oml-ag2ag-consult-transfer,s,1(${EXTEN:4}))
exten => _1111XXX,1,Verbose(2, ag2agConsultTransfer ${EXTEN:4})
same => n,Gosub(sub-oml-ag2ag-consult-transfer,s,1(${EXTEN:4}))
exten => _1111XXXX,1,Verbose(2, ag2agConsultTransfer ${EXTEN:4})
same => n,Gosub(sub-oml-ag2ag-consult-transfer,s,1(${EXTEN:4}))

; Blind Transfer Ag2Camp
exten => _9999X,1,Verbose(2, ag2CampTransfer ${EXTEN:4})
same => n,Gosub(sub-oml-ag2camp-transfer,s,1(${EXTEN:4}))
exten => _9999XX,1,Verbose(2, ag2CampTransfer ${EXTEN:4})
same => n,Gosub(sub-oml-ag2camp-transfer,s,1(${EXTEN:4}))
exten => _9999XXX,1,Verbose(2, ag2CampTransfer ${EXTEN:4})
same => n,Gosub(sub-oml-ag2camp-transfer,s,1(${EXTEN:4}))
exten => _9999XXXX,1,Verbose(2, ag2CampTransfer ${EXTEN:4})
same => n,Gosub(sub-oml-ag2camp-transfer,s,1(${EXTEN:4}))

; Poner en hold una llamada
exten => *098,1,Verbose(hold the line)
same => n,Answer()
same => n,MusicOnHold(default,1200)
same => n,Hangup()

; OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML
; OML OML OML OML OML OML OML OML OML OML         LLAMADAS SALIENTES          OML OML OML OML OML OML OML OML OML
; OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML

[oml-dial-out]
include => oml-dial-out-custom

exten => _X.,1,Verbose(2, Welcome to OMniLeads Contact Center - "Nadie se baña en el rio dos veces porque todo cambia en el rio y en el que se baña" - Heraclito de Efeso)

same => n,Set(EXTEN=${FILTER(0-9,${EXTEN})})
same => n,Gosub(sub-oml-out-check-set,s,1(${EXTEN}))

same => n,Verbose(2, sub return 1: idCamp ${OMLCAMPID}, queue ${OMLCAMPQNAME}, callType ${OMLCALLTYPE}, campType ${OMLCALLTYPEID})
same => n,Verbose(2, sub return 2: agentSIP ${OMLAGENTSIP}, agentName ${OMLAGENTNAME}, idClient ${OMLCODCLI})

same => n,Gosub(sub-oml-blacklist,s,1(${OMLOUTNUM},${OMLCALLTYPEID},${OMLCAMPID}))

same => n(goCampContext),Gosub(sub-oml-campaign-${OMLCALLTYPEID},s,1)
same => n,Gosub(sub-oml-hangup,s,1)

; OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML
; OML OML OML OML OML OML OML OML OML OML         LLAMADAS ENTRANTES      OML OML OML OML OML OML OML OML
; OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML

[oml-dial-in]
include => oml-dial-in-custom

exten => _X.,1,Verbose(2, welcome OML inbound calls)
;same => n,Set(CHANNEL(hangup_handler_push)=sub-oml-post-call-channel-1,s,1(inboundCall))
; security checks
same => n,Set(OMLINRID=${DB(OML/INR/${EXTEN}/ID)})
same => n,GotoIf($["${OMLINRID}" != ""]?inrOk)
same => n,Playback(pbx-invalid)
same => n,Gosub(sub-oml-hangup,s,1(IN-R fail))

same => n(inrOk),Set(OMLINRNAME=${DB(OML/INR/${EXTEN}/NAME)})
same => n,Set(OMLINRDST=${DB(OML/INR/${EXTEN}/DST)})
same => n,Set(__OMLOUTNUM=${CALLERID(num)})
same => n,Gosub(sub-oml-dst-switch,s,1(${OMLINRDST}))
same => n,Gosub(sub-oml-hangup,s,1(IN-R fail))



; OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML
; OML OML OML OML OML OML OML OML         LLAMADAS CLICK2CALL & PREVIEW   OML OML OML OML OML OML OML OML OML OML
; OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML

[click2call]
; conexto invocado por los Originate click2call por DJANGO

include => click2call-custom

exten => _XXXX,1,NoOp(llamada de click2call)
same => n,GotoIf($["${origin}" == "preview"]?preview)
same => n,SIPAddHeader(Origin:CLICK2CALL)
same => n,Dial(SIP/${EXTEN},45,tTc)
same => n,Gosub(sub-oml-hangup,s,1)

same => n(preview),Set(CHANNEL(hangup_handler_push)=sub-oml-post-call-channel-6,s,1)
same => n,SIPAddHeader(Origin:CLICK2CALLPREVIEW)
same => n,SIPAddHeader(IDCliente:${codCli})
same => n,SIPAddHeader(IDCamp:${IdCamp})
same => n,Set(__OMLOUTNUM=${CALLERID(num)})
same => n,Set(__OMLAGENTID=${CUT(FTSAGENTE,_,1)})
same => n,Set(__OMLCAMPID=${IdCamp})
same => n,Set(__OMLCODCLI=${codCli})
same => n,Set(__OMLCALLTYPEID=4)
same => n,Set(__OMLCAMPTYPE=4)

same => n,Gosub(sub-oml-set-chanvars,s,1(${OMLAGENTID},agent))
same => n,Gosub(sub-oml-set-chanvars,s,1(${OMLCAMPID},camp))
same => n,Gosub(sub-oml-set-chanvars,s,1(${OMLCODCLI},client))

same => n,Set(__OMLUNIQUEID=${UNIQUEID})
same => n,Set(__OMLYEARZERO=${EPOCH})
same => n,Set(__OMLCALLSTATUS=DIAL-AGENT)
same => n,Set(__OMLMOTHERCHAN=${CHANNEL})

same => n,Gosub(sub-oml-rec-check,s,1(${OMLCAMPID}))
same => n,GotoIf($["${OMLRECTHISCALL}" == "1"]?recCall)

same => n(dialPreview),Dial(SIP/${EXTEN},45,tTcU(sub-oml-internalcall-connect^previewCall))
same => n,Gosub(sub-oml-hangup,s,1(FAIL FAIL FAIL - ${CONTEXT}))

same => n(recCall),Gosub(sub-oml-rec-filename,s,1(${OMLUNIQUEID},previewCall))
same => n,MixMonitor(${OMLRECFILENAME}.wav,b)
same => n,Goto(dialPreview)


;  OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML  OML OML OML OML OML OMLOML OML OML OML OML OML
;  OML OML OML OML OML OML OML OML OML OML     AGENT ACTIONS DIALPLAN   OML OML OML OML OML OMLOML OML OML OML OML OML
;  OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML  OML OML OML OML OML OMLOML OML OML OML OML OML

[oml-agent-actions]
; Login
exten => 0077LOGIN,1,Verbose(2,Login de agente)
same => n,Set(MemberChannel=${CHANNEL(peername)})
same => n,Set(MemberChanType=${CHANNEL(channeltype)})
same => n,Set(AGENTNAME=${REPLACE(CALLERID(name),"'",)})
same => n,Set(OMLAGENTID=${CUT(CALLERID(name),_,1)})

same => n,Gosub(sub-oml-set-chanvars,s,1(${OMLAGENTID},agent))
same => n,Gosub(sub-oml-agent-login,s,1(${OMLAGENTID},${OMLAGENTSIP},phoneJS))
same => n,Hangup()

; logoff siempre por defecto
;--same => n,Set(ODBC_ID=${OMNILEADS_LOGIN_LOGOUT(${CALLERID(num)})})
same => n,Set(RESULTREMOVE=NULL)
same => n,GotoIf($[${ODBCROWS} < 1]?no_rows,1)
same => n,Set(COUNTER=1)
same => n,While($[${COUNTER} <= ${ODBCROWS}])
same => n,Set(ARRAY(PENALTY,QUEUENAME)=${ODBC_FETCH(${ODBC_ID})})
same => n,NoOp(${QUEUENAME})
same => n,NoOp(${PENALTY})
same => n,RemoveQueueMember(${QUEUENAME},${MemberChanType}/${MemberChannel})
same => n,Set(COUNTER=${INC(COUNTER)})
same => n,NoOp(resultado: ${RQMSTATUS})
same => n,ExecIf($["${RQMSTATUS}" == "REMOVED"]?Gosub(remove-add,s,1))
same => n,EndWhile()
same => n,ODBCFinish()
same => n,GotoIf($["${FLAGREMOVE}" != "true"]?noQueuelog)
same => n,QueueLog(ALL,${UNIQUEID},${OMLAGENTID},REMOVEMEMBER)
; comienza login
same => n(noQueuelog),Set(ODBC_ID=${OMNILEADS_LOGIN_LOGOUT(${CALLERID(num)})})
same => n,GotoIf($[${ODBCROWS} < 1]?no_rows,1)
same => n,Set(COUNTER=1)
same => n,While($[${COUNTER} <= ${ODBCROWS}])
same => n,Set(ARRAY(PENALTY,QUEUENAME)=${ODBC_FETCH(${ODBC_ID})})
same => n,NoOp(${QUEUENAME})
same => n,NoOp(${PENALTY})
same => n,AddQueueMember(${QUEUENAME},${MemberChanType}/${MemberChannel},${PENALTY},,${AGENTNAME})
same => n,Set(COUNTER=${INC(COUNTER)})
same => n,EndWhile()
same => n,ODBCFinish()
same => n,QueueLog(ALL,${UNIQUEID},${OMLAGENTID},ADDMEMBER)
same => n,Playback(silence/1&oml/agente-ok)
same => n,Hangup()
--;

exten => no_rows,1,Verbose(1,No rows returned)
same => n,Playback(silence/1&oml/agente-ok-no-campaign)
same => n,Hangup()

; Logoff
exten => 0077LOGOUT,1,Verbose(2,Logging out of multiple queues)
same => n,Set(MemberChannel=${CHANNEL(peername)})
same => n,Set(MemberChanType=${CHANNEL(channeltype)})
same => n,Set(OMLAGENTID=${CUT(CALLERID(name),_,1)})
same => n,NoOp(pausa: ${DB(OML/AGENT/${OMLAGENTID}/STATUS)})
same => n,GotoIf($["${ISNULL(${DB(OML/AGENT/${OMLAGENTID}/STATUS)})}]?seguir)
same => n,Verbose(2,Agent Unpaused antes de logoff)
same => n,Set(DB(OML/AGENT/${OMLAGENTID}/STATUS)=OFFLINE:${EPOCH})
same => n,Set(AGENTNAME=${REPLACE(CALLERID(name),"'",)})
same => n,QueueLog(ALL,${UNIQUEID},${OMLAGENTID},UNPAUSEALL)
same => n(seguir),Set(AGENTNAME=${REPLACE(CALLERID(name),"'",)})
same => n,Set(ODBC_ID=${OMNILEADS_LOGIN_LOGOUT(${CALLERID(num)})})
same => n,GotoIf($[${ODBCROWS} < 1]?no_rows,1)
same => n,Set(COUNTER=1)
same => n,While($[${COUNTER} <= ${ODBCROWS}])
same => n,Set(ARRAY(PENALTY,QUEUENAME)=${ODBC_FETCH(${ODBC_ID})})
same => n,NoOp(${QUEUENAME})
same => n,NoOp(${PENALTY})
same => n,RemoveQueueMember(${QUEUENAME},${MemberChanType}/${MemberChannel})
same => n,Set(COUNTER=${INC(COUNTER)})
same => n,EndWhile()
same => n,ODBCFinish()
same => n,QueueLog(ALL,${UNIQUEID},${OMLAGENTID},REMOVEMEMBER)
same => n,Playback(silence/1&agent-loggedoff)
same => n,Hangup()

exten => 066LOGOUT,1,Verbose(2,logout desde originate)
same => n,Set(MemberChannel=${AGENTE})
same => n,Set(MemberChanType=SIP)
same => n,Set(AGENTNAME=${AGENTNAME})
same => n,Set(OMLAGENTID=${CUT(AGENTNAME,_,1)})
same => n,NoOP(${AUTOLOGOUT})
same => n,GotoIf($["${AUTOLOGOUT}" == ""]?noauto)
same => n,Set(AGENTE=${CUT(AUTOLOGOUT,-,1)})
same => n,Set(AGENTNAME=${CUT(AUTOLOGOUT,-,2)})
same => n,Set(MemberChannel=${AGENTE})
;same => n(noauto),NoOp(pausa: ${DB(PAUSECUSTOM/AGENT/${AGENTE})})
same => n(noauto),NoOp(pausa: ${DB(OML/AGENT/${OMLAGENTID}/STATUS})})
same => n,GotoIf($["${DB(OML/AGENT/${OMLAGENTID}/STATUS)}" != ' ']?:seguir)
same => n,Verbose(2,Agent Unpaused antes de logoff)
same => n,Set(DB(OML/AGENT/${OMLAGENTID}/STATUS)=OFFLINE:${EPOCH})
same => n,UserEvent(FOP2ASTDB,Family: fop2state,Channel: SIP/${AGENTE},Value: )
same => n,QueueLog(ALL,${UNIQUEID},${OMLAGENTID},UNPAUSEALL)
same => n(seguir),Set(AGENTNAME=${AGENTNAME})
same => n,Set(ODBC_ID=${OMNILEADS_LOGIN_LOGOUT(${AGENTE})})
same => n,GotoIf($[${ODBCROWS} < 1]?no_rows,1)
same => n,Set(COUNTER=1)
same => n,While($[${COUNTER} <= ${ODBCROWS}])
same => n,Set(ARRAY(PENALTY,QUEUENAME)=${ODBC_FETCH(${ODBC_ID})})
same => n,NoOp(${QUEUENAME})
same => n,NoOp(${PENALTY})
same => n,RemoveQueueMember(${QUEUENAME},${MemberChanType}/${MemberChannel})
same => n,Set(COUNTER=${INC(COUNTER)})
same => n,EndWhile()
same => n,ODBCFinish()
same => n,QueueLog(ALL,${UNIQUEID},${OMLAGENTID},REMOVEMEMBER)
same => n,Playback(silence/1&agent-loggedoff)
same => n(bye),Hangup()

; Pausa
exten => _0077X,1,Verbose(2,Pausing member in all queues)
same => n,Set(OMLAGENTID=${CUT(CALLERID(name),_,1)})
same => n,Set(MemberChannel=${CHANNEL(peername)})
same => n,Set(MemberChanType=${CHANNEL(channeltype)})
same => n,Set(PAUSENUM=${EXTEN:4})
same => n,GotoIf($["${EXTEN}" == "00770"]?ACW)
same => n,Set(PAUSETYPE=${DB(OML/GLOBALS/PAUSE/${EXTEN:4})})
same => n,Goto(setagentname)
same => n(ACW),Wait(1)
same => n,Set(PAUSETYPE=ACW)
same => n(setagentname),Set(AGENTNAME=${REPLACE(CALLERID(name),"'",)})
same => n,PauseQueueMember(,${MemberChanType}/${MemberChannel},,${EXTEN:4})
same => n,GotoIf($[${PQMSTATUS} = PAUSED]?agent_paused,1:agent_not_found,1)

exten => _0077XX,1,Verbose(2,Pausing member in all queues)
same => n,Set(OMLAGENTID=${CUT(CALLERID(name),_,1)})
same => n,Set(MemberChannel=${CHANNEL(peername)})
same => n,Set(MemberChanType=${CHANNEL(channeltype)})
same => n,Set(PAUSENUM=${EXTEN:4})
same => n,GotoIf($["${EXTEN}" == "00770"]?ACW)
same => n,Set(PAUSENUM=${EXTEN:4})
same => n,Set(PAUSETYPE=${DB(OML/GLOBALS/PAUSE/${EXTEN:4})})
same => n,Goto(setagentname)
same => n(ACW),Wait(1)
same => n,Set(PAUSETYPE=ACW)
same => n(setagentname),Set(AGENTNAME=${REPLACE(CALLERID(name),"'",)})
same => n,PauseQueueMember(,${MemberChanType}/${MemberChannel},,${EXTEN:4})
same => n,GotoIf($[${PQMSTATUS} = PAUSED]?agent_paused,1:agent_not_found,1)

exten => agent_paused,1,Verbose(2,Agent paused successfully)
same => n,Set(DB(OML/AGENT/${OMLAGENTID}/STATUS)=${PAUSETYPE}:${EPOCH})
same => n,Set(DB(OML/AGENT/${OMLAGENTID}/STATUSID)=${PAUSENUM})
same => n,UserEvent(FOP2ASTDB,Family: fop2state,Channel: SIP/${CALLERID(num)},Value: ${PAUSETYPE})
same => n,QueueLog(ALL,${UNIQUEID},${OMLAGENTID},PAUSEALL,${PAUSENUM})
same => n,Playback(silence/1&oml/agente-pausa)
same => n,Hangup()

; Salir de Pausa
exten => 0077UNPAUSE,1,Verbose(2,UnPausing member in all queues)
same => n,Set(OMLAGENTID=${CUT(CALLERID(name),_,1)})
same => n,Set(PAUSEID=${DB(OML/AGENT/${OMLAGENTID}/STATUSID)})
same => n,Set(MemberChannel=${CHANNEL(peername)})
same => n,Set(MemberChanType=${CHANNEL(channeltype)})
same => n,Set(AGENTNAME=${REPLACE(CALLERID(name),"'",)})
same => n,UnPauseQueueMember(,${MemberChanType}/${MemberChannel})
same => n,GotoIf($[${UPQMSTATUS} = UNPAUSED]?agent_unpaused,1:agent_not_found,1)

exten => agent_unpaused,1,Verbose(2,Agent paused successfully)
same => n,Set(DB(OML/AGENT/${OMLAGENTID}/STATUS)=OFFLINE:${EPOCH})
same => n,Set(DB(OML/AGENT/${OMLAGENTID}/STATUS)=READY:${EPOCH})
same => n,UserEvent(FOP2ASTDB,Family: fop2state,Channel: SIP/${CALLERID(num)},Value: )
same => n,QueueLog(ALL,${UNIQUEID},${OMLAGENTID},UNPAUSEALL,${PAUSEID})
same => n,Playback(silence/1&oml/agente-disponible)
same => n,Hangup()

exten => agent_not_found,1,Verbose(2,Agent was not found)
same => n,Playback(silence/1&oml/agente-no-campaign)

exten => 0077REMOVE,1,NoOp(agente ${CALLERID(num)} removido)
same => n,NoOp(${CALLERID(num)} removido del sistema)
same => n,NoOp(${CALLERID(num)} removido del sistema)
same => n,Hangup()


;  OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML  OML OML OML OML OML OMLOML OML OML OML OML OML
;  OML OML OML OML OML OML OML OML OML OML     SUPERVISION DALPLAN      OML OML OML OML OML OMLOML OML OML OML OML OML
;  OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML OML  OML OML OML OML OML OMLOML OML OML OML OML OML

[oml-sup]
exten => _001X,1,NoOp(Channel Spy)
same => n,ChanSpy(SIP/${EXTEN:3:4},sb)
same => n,Hangup()

exten => _001X.,1,NoOp(Channel Spy)
same => n,ChanSpy(SIP/${EXTEN:3:4},sb)
same => n,Hangup()

exten => _002X,1,NoOp(Channel Spy and Wishper)
same => n,ChanSpy(SIP/${EXTEN:3:4},swb)
same => n,Hangup()

exten => _002X.,1,NoOp(Channel Spy and Wishper)
same => n,ChanSpy(SIP/${EXTEN:3:4},swb)
same => n,Hangup()

;exten => _003X,1,NoOp(Agent Logoff)
;same => n,GotoIf($["${SIP_HEADER(supToken)}" == "abc098"]?pasa)
;same => n,Hangup()
;same => n(pasa),NoOp(Agente: ${EXTEN:3})
;same => n,DBDel(PAUSECUSTOM/AGENT/${EXTEN:3})
;same => n,DBDel(fop2state/SIP/${EXTEN:3})
;same => n,Set(MemberChannel=${EXTEN:3})
;same => n,Set(MemberChanType=SIP)
;same => n,Set(AGENTNAME=${SIP_HEADER(nombreAgente)})
;same => n,Set(ODBC_ID=${OMNILEADS_LOGIN_LOGOUT(${EXTEN:3})})
;same => n,GotoIf($[${ODBCROWS} < 1]?no_rows,1)
;same => n,Set(COUNTER=1)
;same => n,While($[${COUNTER} <= ${ODBCROWS}])
;same => n,Set(ARRAY(PENALTY,QUEUENAME)=${ODBC_FETCH(${ODBC_ID})})
;same => n,NoOp(${QUEUENAME})
;same => n,NoOp(${PENALTY})
;same => n,RemoveQueueMember(${QUEUENAME},${MemberChanType}/${MemberChannel})
;same => n,Set(COUNTER=${INC(COUNTER)})
;same => n,EndWhile()
;same => n,ODBCFinish()
;same => n,QueueLog(ALL,${UNIQUEID},${AGENTNAME},REMOVEMEMBER)
;same => n,Playback(silence/1&agent-loggedoff)
;same => n,Hangup()

;exten => _003X.,1,NoOp(Agent Logoff)
;same => n,GotoIf($["${SIP_HEADER(supToken)}" == "abc098"]?pasa)
;same => n,Hangup()
;same => n(pasa),NoOp(Agente: ${EXTEN:3})
;same => n,DBDel(PAUSECUSTOM/AGENT/${EXTEN:3})
;same => n,DBDel(fop2state/SIP/${EXTEN:3})
;same => n,Set(MemberChannel=${EXTEN:3})
;same => n,Set(MemberChanType=SIP)
;same => n,Set(AGENTNAME=${SIP_HEADER(nombreAgente)})
;same => n,Set(ODBC_ID=${OMNILEADS_LOGIN_LOGOUT(${EXTEN:3})})
;same => n,GotoIf($[${ODBCROWS} < 1]?no_rows,1)
;same => n,Set(COUNTER=1)
;same => n,While($[${COUNTER} <= ${ODBCROWS}])
;same => n,Set(ARRAY(PENALTY,QUEUENAME)=${ODBC_FETCH(${ODBC_ID})})
;same => n,NoOp(${QUEUENAME})
;same => n,NoOp(${PENALTY})
;same => n,RemoveQueueMember(${QUEUENAME},${MemberChanType}/${MemberChannel})
;same => n,Set(COUNTER=${INC(COUNTER)})
;same => n,EndWhile()
;same => n,ODBCFinish()
;same => n,QueueLog(ALL,${UNIQUEID},${AGENTNAME},REMOVEMEMBER)
;same => n,Playback(silence/1&agent-loggedoff)
;same => n,Hangup()

;exten => _004X,1,NoOp(Agent Pause)
;same => n,GotoIf($["${SIP_HEADER(supToken)}" == "abc098"]?pasa)
;same => n,Hangup()
;same => n(pasa),NoOp(Agente: ${EXTEN:3})
;same => n,Set(MemberChannel=${EXTEN:3})
;same => n,Set(MemberChanType=SIP)
;same => n,Set(PAUSETYPE=Supervisor)
;same => n,PauseQueueMember(,${MemberChanType}/${MemberChannel},,${PAUSETYPE})
;same => n,GotoIf($[${PQMSTATUS} = PAUSED]?agent_paused,1:agent_not_found,1)

;exten => _004X.,1,NoOp(Agent Pause)
;same => n,GotoIf($["${SIP_HEADER(supToken)}" == "abc098"]?pasa)
;same => n,Hangup()
;same => n(pasa),NoOp(Agente: ${EXTEN:3})
;same => n,Set(MemberChannel=${EXTEN:3})
;same => n,Set(MemberChanType=SIP)
;same => n,Set(PAUSETYPE=Supervisor)
;same => n,PauseQueueMember(,${MemberChanType}/${MemberChannel},,${PAUSETYPE})
;same => n,GotoIf($[${PQMSTATUS} = PAUSED]?agent_paused,1:agent_not_found,1)

;exten => agent_paused,1,Verbose(2,Agent paused successfully)
;same => n,Set(DB(PAUSECUSTOM/AGENT/${EXTEN:3})=${PAUSETYPE}:${EPOCH})
;same => n,Set(DB(fop2state/SIP/${EXTEN:3})=${PAUSETYPE})
;same => n,UserEvent(FOP2ASTDB,Family: fop2state,Channel: SIP/${EXTEN:3},Value: ${PAUSETYPE})
;same => n,Playback(silence/1&oml/agente-pausa)
;same => n,Hangup()

;exten => _005X,1,NoOp(Tomar llamada)
;same => n,ChanSpy(SIP/${EXTEN})
;same => n,Hangup()

;exten => _005X.,1,NoOp(Tomar llamada)
;same => n,ChanSpy(SIP/${EXTEN})
;same => n,Hangup()

;exten => _006X,1,NoOp(Conferencia)
;same => n,ChanSpy(SIP/${EXTEN},swbB)
;same => n,Hangup()

;exten => _006X.,1,NoOp(Conferencia)
;same => n,ChanSpy(SIP/${EXTEN},swbB)
;same => n,Hangup()

;exten => _007X,1,NoOp(Agent Un-Pause)
;same => n,GotoIf($["${SIP_HEADER(supToken)}" == "abc098"]?pasa)
;same => n,Hangup()
;same => n(pasa),NoOp(Agente: ${EXTEN:3})
;same => n,Set(MemberChannel=${EXTEN:3})
;same => n,Set(MemberChanType=SIP)
;same => n,UnPauseQueueMember(,${MemberChanType}/${MemberChannel})
;same => n,GotoIf($[${UPQMSTATUS} = UNPAUSED]?agent_unpaused,1:agent_not_found,1)

;exten => _007X.,1,NoOp(Agent Un-Pause)
;same => n,GotoIf($["${SIP_HEADER(supToken)}" == "abc098"]?pasa)
;same => n,Hangup()
;same => n(pasa),NoOp(Agente: ${EXTEN:3})
;same => n,Set(MemberChannel=${EXTEN:3})
;same => n,Set(MemberChanType=SIP)
;same => n,UnPauseQueueMember(,${MemberChanType}/${MemberChannel})
;same => n,GotoIf($[${UPQMSTATUS} = UNPAUSED]?agent_unpaused,1:agent_not_found,1)

;exten => agent_unpaused,1,Verbose(2,Agent paused successfully)
;same => n,DBDel(PAUSECUSTOM/AGENT/${EXTEN:3})
;same => n,DBDel(fop2state/SIP/${EXTEN:3})
;same => n,UserEvent(FOP2ASTDB,Family: fop2state,Channel: SIP/${EXTEN:3},Value: )
;same => n,Playback(silence/1&oml/agente-disponible)
;same => n,Hangup()

;exten => agent_not_found,1,Verbose(2,Agent was not found)
;same => n,Playback(silence/1&cannot-complete-as-dialed)
