---

- name: Modify of pg_hba.conf file
  template: src=roles/kamailio/templates/pg_hba.conf.j2 dest=/var/lib/pgsql/9.6/data/pg_hba.conf
  become: true
  become_method: sudo

- name: Restart postgres service
  service: name=postgresql-9.6 state=restarted enabled=yes
  become: true
  become_method: sudo

- name: Create kamailio postgres user
  become: yes
  become_method: sudo
  become_user: postgres
  postgresql_user: name=kamailio password=kamailiorw role_attr_flags=SUPERUSER

- name: Create kamailioro postgres user
  postgresql_user: name=kamailioro password=kamailioro role_attr_flags=SUPERUSER
  become: yes
  become_method: sudo
  become_user: postgres
<<<<<<< HEAD
=======

- name: Create kamailio database
  shell: createdb -O kamailio kamailio
  become: yes
  become_method: sudo
  become_user: postgres
  register: command_result
  failed_when:
    - "'already exists' not in command_result.stderr"
    - "'ya existe' not in command_result.stderr"
    - "command_result.rc != 0"

#- name: Create plpython to database
#  shell: createlang plpythonu kamailio
#  become: yes
#  become_method: sudo
#  become_user: postgres
#  failed_when:
#    - "'already installed' not in command_result.stderr"
#    - "'instalado' not in command_result.stderr"
#    - "command_result.rc != 2"

#- name: Execution of kamdbctl script
#  shell: "{{ kamailio_location }}/sbin/kamdbctl restore {{ install_prefix }}ominicontacto/ominicontacto_voip/kamailio-files/kamdb.sql"
#  when: kamailio_installed|failed
#  become: true
#  become_method: sudo
>>>>>>> sigo puliendo esto todav√≠a falta mucho
