FROM centos:latest
ENV LANG en_US.utf8

RUN yum update -y
RUN yum groupinstall core base "Development Tools" -y
RUN yum install vim -y
COPY irontec.repo /etc/yum.repos.d/irontec.repo
RUN rpm --import http://packages.irontec.com/public.key
RUN yum install vim sngrep -y
WORKDIR /usr/src
RUN wget https://downloads.asterisk.org/pub/telephony/asterisk/old-releases/asterisk-13.22.0.tar.gz
RUN wget https://github.com/akheron/jansson/archive/v2.7.tar.gz
RUN tar xzvf asterisk-13.22.0.tar.gz && tar xzvf v2.7.tar.gz
WORKDIR /usr/src/jansson-2.7
RUN autoreconf -i && ./configure && make && make install
WORKDIR /usr/src/asterisk-13.22.0
RUN contrib/scripts/install_prereq install
RUN ./configure --with-pjproject-bundled && contrib/scripts/get_mp3_source.sh && \
    make menuselect && make && make install && make config && make samples && ldconfig
RUN /etc/init.d/asterisk start
CMD ["/sbin/init"]
