---

- hosts: omni-app
  tasks:
          - name: Createlang of the database
            shell: "createlang plpythonu kamailio"
            become: yes
            become_user: postgres 
            when: not post_install

          - name: Run Django migrations
            django_manage: >
                    command={{ item }}
                    app_path={{ django_dir }}
                    settings=ominicontacto.settings
                    virtualenv={{ django_dir }}/virtualenv
            with_items:
                    - migrate
                    - "createsuperuser --noinput --username={{ admin_user }} --email=admin@example.com"
            ignore_errors: yes
            notify: restart ominicontacto-daemon
            tags:
                    - deploy

  handlers:
          - name: restart ominicontacto-daemon
            service: name=ominicontacto-daemon state=restarted enabled=yes
