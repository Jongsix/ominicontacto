---

- name: Install of postgresql 9.6
  yum: "name={{ postgresql_url }} state=present validate_certs=no "
- yum: name=postgresql96* state=present
  tags: issabel

- name: Install of the other packages
  yum: "name={{ item }} state=present"
  with_items:
      - python-psycopg2.x86_64
      - python2-psycogreen.noarch
      - python
      - python-virtualenv
      - python-devel
      - mysql-connector-python
      - mysql-devel
      - nginx
      - nginx-all-modules
      - libjpeg-turbo-devel
      - libffi-devel
      - libffi
      - libpqxx
      - libpqxx-devel
      - cairo-devel
      - pycairo
      - pycairo-devel
      - cairo
      - libpqxx
      - libpqxx-devel
      - python-pycha
      - libxslt-devel
      - libxslt-python
      - libxslt
      - python-lxml
      - libxslt-python
      - postgresql-plpython
      - postgresql-libs
      - postgresql-devel
      - libsass-devel
      - libsass
      - python2-pip.noarch
  tags: issabel
- meta: clear_host_errors

- name: install php56wpgsql
  yum: name=php56w-pgsql state=present
- meta: clear_host_errors

- name: install phppgsql
  yum: name=php56w-pgsql state=present
- meta: clear_host_errors
  tags: issabel

- name: Setup of postgresql
  command: "/usr/pgsql-9.6/bin/postgresql96-setup initdb"
  register: command_result
  failed_when:
    - "'is not empty' not in command_result.stdout"
    - "command_result.rc != 0"
  tags: issabel


- shell: "{{ item }}"
  with_items:
      - systemctl enable postgresql-9.6.service
      - systemctl start postgresql-9.6.service
      - systemctl start redis
      - systemctl enable redis
  tags: issabel

